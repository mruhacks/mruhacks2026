CREATE VIEW "public"."participant_form_view" AS (WITH interests AS ( SELECT participant_interests.user_id, array_agg(DISTINCT participant_interests.interest_id) AS interests FROM participant_interests WHERE participant_interests.interest_id IS NOT NULL GROUP BY participant_interests.user_id ), dietary AS ( SELECT participant_dietary_restrictions.user_id, array_agg(DISTINCT participant_dietary_restrictions.restriction_id) AS dietary_restrictions FROM participant_dietary_restrictions WHERE participant_dietary_restrictions.restriction_id IS NOT NULL GROUP BY participant_dietary_restrictions.user_id ) SELECT p.user_id, p.full_name, p.attended_before, p.gender_id, p.university_id, p.major_id, p.year_of_study_id, p.heard_from_id, p.needs_parking, p.accommodations, p.consent_info_use, p.consent_sponsor_share, p.consent_media_use, COALESCE(i.interests, '{}'::integer[]) AS interests, COALESCE(d.dietary_restrictions, '{}'::integer[]) AS dietary_restrictions, p.created_at FROM participants p LEFT JOIN interests i USING (user_id) LEFT JOIN dietary d USING (user_id));
